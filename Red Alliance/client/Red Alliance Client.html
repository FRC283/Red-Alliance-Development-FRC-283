<html>
	<head>
		<title>RED ALLIANCE CLIENT</title>
		<link rel="stylesheet" type="text/css" href="../css/client_style.css">
		
	</head>
	<body>
		<header>
			<div id="logo">FRC Team 283 - RED ALLIANCE</div>
		</header>
		<div class="tab">
			<button class="tablinks tab-selected" onClick="switchTab(matchForm)" id="matchTab">Match Form</button>
			<button class="tablinks" onClick="switchTab(pitForm)" id="pitTab">Pit Form</button>
		</div>
		
		<div class="form-container">
			<div id="matchForm" class="tabContent" style="display:block">
				<form id='matchData' name='matchData' onSubmit='return false;'>
					<fieldset>
						Match Number: <input autofocus type="number" step="1" min="0" max="9999" name='Match Number' class="matchForm" required><br>
						Team Name: <input type='text' name='Team Name' class="matchForm"><br>
						Team Number: <input type="number" step="1" min="1" max="9999" class='matchForm' name="Team Number" required><br>
						<input type="radio" name="Color" class="matchForm" value="Red" required> Red<br>
		 	 			<input type="radio" name="Color" value="Blue" required> Blue<br>
		 	 			
		 	 			<div class="autoTeleop-container">
			 	 			<div class="tab">
								<button type=button class="tablinks tab-selected" onClick="switchTab(autoForm)" id="autoTab">Auto Form</button>
								<button type=button class="tablinks" onClick="switchTab(teleopForm)" id="teleopTab">Teleop Form</button>
							</div>
						
							<div id="autoForm" class="tabContent" style="display:block">
				 	 			Crosses Baseline Successfully?
				 	 			Cubes Put in Switch: <input type="number" step="1" min="0" max="9999" class='matchForm' name="Cubes in Switch (Auto)" required><br>
				 	 			Cubes Put in Scale: <input type="number" step="1" min="0" max="9999" class='matchForm' name="Cubes in Scale (Auto)" required><br>
				 	 			Cubes Put in Vault/Exchange Zone: <input type="number" step="1" min="0" max="9999" class='matchForm' name="Cubes in Vault/Exchange (Auto)" required><br>
			 	 				Overview/Comments
			 	 			</div>
							
							<div id="teleopForm" class="tabContent" style="display:none">
				 	 			Cubes Put in Switch (fraction): <input type="number" step="1" min="0" max="9999" class='matchForm' name="Cubes in Switch (Teleop)" required><br>
				 	 			Cubes Put in Scale (fraction): <input type="number" step="1" min="0" max="9999" class='matchForm' name="Cubes in Scale (Teleop)" required><br>
				 	 			Cubes Put in Vault/Exchange Zone (fraction): <input type="number" step="1" min="0" max="9999" class='matchForm' name="Cubes in Vault/Exchange (Teleop)" required><br>
				 	 			Primary Source of Cubes: (Platform, Enemy Platform, Portal, Power Cube Zone)
				 	 			Robot Attempts to Block Enemy Scoring:
				 	 			Robot Physically Lifts Successfully:
				 	 				Another Robot Hangs off of This One:
				 	 			Primary Strategy/Cycle:
				 	 			Overview/Comments: <input name="Overview" type="text" class="matchForm" required><br>
							</div>
						</div>
		 	 			
						<button onClick='generateMatchSheet();' class="form-submit">Finish</button>
						<a onClick="document.getElementById('matchData').reset();" download="matchData.csv" id="matchLink" href="" style="display: none">Download Match Data</a>
					</fieldset>
				</form>
				</div>
			
			<div id="pitForm" class="tabContent" style="display:none">
				<form id='pitData' name='pitData' onSubmit='return false;'>
					<fieldset>
						Image of Robot: <input id='jpgU' type='file' ></input><br>
						Team Name: 
						Team Number: <input type="number" step="1" min="1" max="9999" class='pitform' name="Team Number" required><br>
						Drivetrain: <input name="Drivetrain" type="text" class="pitForm" required><br>
						//^Checkboxes
						//Number of motors
						//Style of Drivetrain
						//Wheels
						//Additional (option) 
						Robot Can Lift: <input name="Lift?" type="checkbox" class="pitForm" required>
							Lift Clearance from Ground:
						Robot Allows Another Robot To Lift: (Number 0-2)
						Weight (we can block light robots, including ambiguity/unknown, make it a slider):
						Automatically Adjusts for Field Side:
						Puts Cube on Switch in Auto:
						Puts Cube on Scale in Auto:
						Primary Source of Cubes:
						Primary Teleop Strategy: <input name="Primary Strategy" type="text" class="pitForm" required><br>
						//Switch, scale, vault, lift, defense
						Overview/Comments: <input name="Overview" type="text" class="pitForm" required><br>
						<button onClick="generatePitSheet(jpgU)" class="form-submit">Finish</button><br>
						
						<a onClick="document.getElementById('pitData').reset();" download="pitData.csv" id="pitLink" href="" style="display: none">Download Pit Data</a>
					</fieldset>
				</form>
			</div>
		</div>
		
		<script>
			//TODO
			/*
				List of Team Names for a Competition so people cant misstype
				Tab or Arrow Keys for advancing to next variable
				Auto download on submit
				No submission on blank form
				Remove download link on click
			*/
			//Explanation of how it works:
			/*
				When the 'Finish' button is called, the generateMatchSheet() or generatePitSheet() function is called, respectively.
				Those functions grab all the forms, put them in a file, then puts a link to download that file
				
			*/
			document.addEventListener("keydown", arrowMove, false);
			
			function arrowMove(e) //e = keydown event
			{
				document.getElementById()
			}
			
			function generateMatchSheet()
			{
				var form = document.getElementsByClassName("matchForm"); //Grab the matchForm DOM
				//CES - Comma encoding system:
					//Change all commas to '@?$COMMA$?@' on this end
					//On the master end, transform them back
				var formText = ""; //Part of the CSV file that holds the data
				var formHeader = ""; //Part of the CSV file that holds the various 'variables' or headers
				for (i = 0; i < form.length; i++) //For each variable in the form
				{
					console.log("form[" + i + "]: " + form[i].value + " type:" + form[i].type); //Print out the value, name and type of this variable
					if (form[i].type == "radio") //If the type is radio
					{
						var options = document.getElementsByName(form[i].name); //Get all elements with the chosen name
						for (w = 0; w < options.length; w++) //For each button in this set
						{
							console.log("Looking at radio button " + (w + 1) + " of " + options.length);
							if (options[w].checked == true) //Look for the one with checked=true
							{
								formText = formText + options[w].value + ((i < form.length - 1) ? "," : ""); //No need to replace commas because we're not that dumb
								//^ Adds the radio button value onto the CSV file
							}
						}
					}
					else
					{
						formText = formText + form[i].value.replace(/(,)+/g, '@?$COMMA$?@') + ((i < form.length - 1) ? "," : ""); //Replace commas with the code, then Separate values with commas
						//^ Adds this data onto the next part of the csv file
					}
					formHeader = formHeader + form[i].name + ((i < form.length - 1) ? "," : ""); //The ternary operator cuts the comma off the last line
					
				}
				formText = formText + "\r\n"; //Proper escaping - creates new line on the file
				formHeader = formHeader + "\r\n"; //Proper escaping - creates new line on the file
				console.log("The form contained the text: " + formText);
				
				//Encode into a file, then put that file as the download link
				var file = new Blob([formHeader + formText], {type: "text/plain"}); //Creates a 'file' blob that contain the text encoded
				document.getElementById("matchLink").href = window.URL.createObjectURL(file); //Associates a temporary url with the file to allow download
				var idNum = Math.floor(Math.random() * 10000); //Assigns a random ID to the file for tracking purposes
				document.getElementById("matchLink").download = "matchData" + idNum + ".csv";
				document.getElementById("matchLink").innerHTML = "Download Match Data " + idNum;
				document.getElementById("matchLink").style.display = 'block';
				//^ Above: set proper page elements to allow download
			}
			
			
			function generatePitSheet(element)
			{
				var file = element.files[0]; //Grab the one and only image allowed 
				var fr = new FileReader(); //Generate a file reader
				fr.onloadend = function() //Executes when file is read
				{
					var form = document.getElementsByClassName("pitForm");
					//CES - Comma encoding system:
						//Change all commas to '@?$COMMA$?@' on this end
						//On the master end, transform them back
					var formText = fr.result.replace(/[,]+/g, '@?$COMMA$?@') + ","; //For pit data, this is always the first column, take out the comma
					var formHeader = "Robot Image,"; //Same as above
					for (i = 0; i < form.length; i++)
					{
						console.log("form[" + i + "]: " + form[i].value + " type:" + form[i].type);
						if (form[i].type == "radio")
						{
							var options = document.getElementsByName(form[i].name); //Get all elements with the chosen name
							for (w = 0; w < options.length; w++) //Look for the one with checked=true
							{
								console.log("Looking at radio button " + (w + 1) + " of " + options.length);
								if (options[w].checked == true)
								{
									formText = formText + options[w].value + ((i < form.length - 1) ? "," : ""); //No need to replace commas because we're not that dumb
								}
							}
						}
						else
						{
							formText = formText + form[i].value.replace(/[,]+/g, '@?$COMMA$?@') + ((i < form.length - 1) ? "," : ""); //Replace commas with the code, then Separate values with commas
						}
						formHeader = formHeader + form[i].name + ((i < form.length - 1) ? "," : ""); //The ternary operator cuts the comma off the last line
						
					}
					formText = formText + "\r\n"; //Proper escaping
					formHeader = formHeader + "\r\n"; //Proper escaping
					console.log("The form contained the text: " + formText);
					
					//Encode into a file, then put that file as the download link
					var file = new Blob([formHeader + formText], {type: "text/plain"});
					document.getElementById("pitLink").href = window.URL.createObjectURL(file);
					var idNum = Math.floor(Math.random() * 10000);
					document.getElementById("pitLink").download = "pitData" + idNum + ".csv";
					document.getElementById("pitLink").innerHTML = "Download Pit Data " + idNum;
					document.getElementById("pitLink").style.display = 'block';
					
				}
				fr.readAsDataURL(file);	//Read the file
			}
			
			function switchTab(identifier)
			{
				if (identifier.id.toString() == "matchForm")
		        {
		            document.getElementById("matchTab").classList.add("tab-selected");
		            document.getElementById("matchForm").style.display = "block";
		            document.getElementById("pitTab").classList.remove("tab-selected");
		            document.getElementById("pitForm").style.display = "none";
		        }
		        else if (identifier.id.toString() == "pitForm")
		        {
		            document.getElementById("pitTab").classList.add("tab-selected");
		            document.getElementById("pitForm").style.display = "block";
		            document.getElementById("matchTab").classList.remove("tab-selected");
		            document.getElementById("matchForm").style.display = "none";
		        }
				if (identifier.id.toString() == "autoForm")
		        {
		            document.getElementById("autoTab").classList.add("tab-selected");
		            document.getElementById("autoForm").style.display = "block";
		            document.getElementById("teleopTab").classList.remove("tab-selected");
		            document.getElementById("teleopForm").style.display = "none";
		        }
		        else if (identifier.id.toString() == "teleopForm")
		        {
		            document.getElementById("teleopTab").classList.add("tab-selected");
		            document.getElementById("teleopForm").style.display = "block";
		            document.getElementById("autoTab").classList.remove("tab-selected");
		            document.getElementById("autoForm").style.display = "none";
		        } 
			}
		</script>	
	</body>
<html>